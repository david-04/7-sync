//----------------------------------------------------------------------------------------------------------------------
// Base class for all output streams
//----------------------------------------------------------------------------------------------------------------------

interface OutputStream {
    log(line: string): void;
}

//----------------------------------------------------------------------------------------------------------------------
// A muted output stream
//----------------------------------------------------------------------------------------------------------------------

class NullOutputStream implements OutputStream {
    log(_line: string) { }
}

//----------------------------------------------------------------------------------------------------------------------
// A console output stream (stdout)
//----------------------------------------------------------------------------------------------------------------------

class ConsoleOutputStream implements OutputStream {
    log(line: string) {
        console.log(line);
    }
}

//----------------------------------------------------------------------------------------------------------------------
// A file output stream
//----------------------------------------------------------------------------------------------------------------------

class FileOutputStream implements OutputStream {

    private stream: { write: (data: string) => void };

    //------------------------------------------------------------------------------------------------------------------
    // Initialisation
    //------------------------------------------------------------------------------------------------------------------

    public constructor(file: string, append: boolean) {
        try {
            this.stream = nodeModules.fs.createWriteStream(file, append ? { flags: 'a' } : {});
        } catch (exception) {
            throw new FriendlyException(`ERROR: Failed to open file ${file} - ${exception}`);
        }
    }

    //------------------------------------------------------------------------------------------------------------------
    // Append a message to the logfile
    //------------------------------------------------------------------------------------------------------------------

    public log(line: string) {
        this.stream.write(line + "\n");
    }
}
